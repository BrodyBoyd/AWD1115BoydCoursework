@using Microsoft.AspNetCore.Identity
@using PeePal.Models

@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager

<ul class="flex items-center gap-4">
    @if (SignInManager.IsSignedIn(User))
    {
        <li class="relative group">
            @{ var currentUser = await UserManager.GetUserAsync(User); }

            <button class="inline-flex items-center gap-3 px-3 py-2 rounded-full bg-primary text-primary hover:bg-primary/20 transition font-medium">
                <span class="flex items-center justify-center w-8 h-8 rounded-full bg-primary text-primary-foreground font-bold">@((currentUser?.ProfileUsername ?? "U").Substring(0,1).ToUpper())</span>
                <span class="hidden sm:inline text-secondary">Hello @(currentUser?.ProfileUsername ?? "User")</span>
                <svg class="w-4 h-4 text-muted-foreground transition-transform group-hover:-rotate-180" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                </svg>
            </button>

            <div class="absolute right-0 mt-2 w-44 bg-card rounded-lg border border-border shadow-md opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 overflow-hidden">
                <a href="#" class="block px-4 py-2 text-sm text-secondary hover:bg-muted transition">Account</a>

                <form asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Action("Index", "Home", new { area = "" })">
                    <button type="submit" class="w-full text-left px-4 py-2 text-sm text-secondary hover:bg-muted transition">Logout</button>
                </form>
            </div>
        </li>
    }
    else
    {
        <li>
            <a id="register" asp-area="Identity" asp-page="/Account/Register" class="inline-flex items-center gap-2 px-3 py-2 rounded-full border border-border text-sm text-foreground hover:bg-muted transition">Register</a>
        </li>
        <li>
            <a id="login" asp-area="Identity" asp-page="/Account/Login" class="inline-flex items-center gap-2 px-3 py-2 rounded-full bg-primary text-primary-foreground text-sm hover:opacity-90 transition">Login</a>
        </li>
    }
</ul>
